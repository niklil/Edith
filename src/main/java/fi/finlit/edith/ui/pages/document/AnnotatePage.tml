<html t:type="layout"  
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
      xmlns:p="tapestry:parameter">
      
    <p:title>${document.title}</p:title>  

    <div class="content">
        <t:zone t:id="documentZone" update="show">
            <t:delegate to="documentView"/>
        </t:zone>
        <t:block t:id="documentView">
        <t:document.view document="documentRevision"/>        
        </t:block>                
    </div>
    
    <p:breadcrumbs>
        <a t:type="pageLink" t:page="index">${message:frontpage}</a> 
        &gt; <a t:type="pageLink" t:page="documentsPage">${message:documents}</a>
        &gt; ${document.title}
    </p:breadcrumbs>     
        
    <p:leftPanel>
        <t:dashboard/>
        
        <p>
            <a t:type="pageLink" t:page="document/viewPage" t:context="${document.id}">${message:to-view-document}</a>
        </p>
        
        <div class="panel narrow">
            <h3>${message:pages}</h3>
            <t:document.pages document="documentRevision"/>
            <div style="clear:both;"></div>
        </div>

        
    </p:leftPanel>

    <p:rightPanel>
        <t:form t:id="createTerm" t:zone="listZone">
            <t:hidden t:id="selectedText_1" value="createTermSelection.selection"/>
            <t:hidden t:id="selectedStartId_1" value="createTermSelection.startId"/>
            <t:hidden t:id="selectedEndId_1" value="createTermSelection.endId"/>
            <t:hidden t:id="selectedStartIndex_1" value="createTermSelection.startIndex"/>
            <t:hidden t:id="selectedEndIndex_1" value="createTermSelection.endIndex"/>
            <a id="createTermLink" class="disabled selection-link" href="#">${message:createTerm}</a>
        </t:form>
           
        <div class="panel narrow">
            <h3>${message:notes}</h3>
                <t:zone t:id="listZone" update="show">
                    <t:delegate to="notesList"/>
                </t:zone>
            <div style="clear:both;"></div>
        </div>    
    
        <t:zone t:id="editZone" update="show"/>
        
        <t:block t:id="notesList">
            <t:if test="docNotes">
            <ul class="notes">
                <t:loop source="docNotes" value="note">
                <li> 
                    <a href="#start${note.revisionOf.localId}" class="notelink ${note.revisionOf.status}"><em>${note.lemma}</em></a>
                </li>
                </t:loop>
            </ul>        
                <p:else>${message:no-notes}</p:else>
            </t:if>
        </t:block>
         
        <t:block t:id="noteEdit">
            <t:if test="!selectedNotes.empty">
            <div class="panel narrow">
                
                <t:if test="moreThanOneSelectable">
                <h3>${message:selectNote}</h3>
                <ul class="notes">
                    
                    <t:loop source="selectedNotes" value="note">
                        <li>
                            <t:eventlink t:event="edit" context="editContext" 
                                t:zone="editZone" class="notelink"><em>${note.lemma}</em></t:eventlink> 
                        </li>
                    </t:loop>
                </ul>
                </t:if>
                
                <h3>${message:noteEdit}</h3>
                <p id="edited_info"> 
                    <t:dateTimeFormat date="noteOnEdit.createdOnDate" format="message:dateformat-compact"/>
                    ${noteOnEdit.createdBy.username}
                </p>
                <div class="cleaner"></div>
                <div class="note_edit">
                    <em><strong>${noteOnEdit.lemma}</strong></em> 
                    <t:eventlink t:event="delete" t:zone="editZone" context="noteOnEdit.id">${message:delete}</t:eventlink>
                    <t:form t:id="noteEditForm" t:zone="editZone" t:context="noteOnEdit.id">
                        <t:errors/>
                        <table>
                        <tr>
                          <th>${message:lemma-label}</th>
                          <td><t:textField value="noteOnEdit.lemma"/></td>
                        </tr>
                        
                        <tr>
                          <th>${message:basicForm-label}</th>
                          <td><t:textField t:id="basicForm" value="termOnEdit.basicForm" t:mixins="autocomplete"/></td>
                        </tr>
                        
                        <tr>
                          <th>${message:description-label}</th>                     
                          <td><t:textField t:id="description" value="noteOnEdit.description"/></td>
						</tr>

						<tr>
                          <th>${message:subtextSources-label}</th>                     
                          <td><t:textField t:id="subtextSources" value="noteOnEdit.subtextSources"/></td>
						</tr>
						
						<tr>
						  <!-- <th>${message:meaning-label}?</th>                     
                          <td><t:textField t:id="meaning" value="termOnEdit.meaning"/></td> -->
                        </tr>
                        
                        <tr>
                          <th></th>
                          <td><a id="longTextEditLink" href="#" style="display:none">${message:update}</a></td>
                        </tr>
                        
                        <tr>
                          <th>${message:longText-label}</th>
                          <td><div id="longTextEdit">${noteOnEdit.longText}</div></td>
                        </tr>
                        
                        <t:hidden t:id="selectedText_2" value="updateLongTextSelection.selection"/>
                        <t:hidden t:id="selectedStartId_2" value="updateLongTextSelection.startId"/>
                        <t:hidden t:id="selectedEndId_2" value="updateLongTextSelection.endId"/>
                        <t:hidden t:id="selectedStartIndex_2" value="updateLongTextSelection.startIndex"/>
                        <t:hidden t:id="selectedEndIndex_2" value="updateLongTextSelection.endIndex"/>  
                                                            
                        </table>
                        <input type="submit" value="${message:save}"/>
                        <t:if test="submitSuccess">
                        	<!-- This could be externalized? -->
                         	<script type="text/javascript">jQuery(function() { jQuery("#submit_success_info").fadeOut(3000); });</script>
                        	<p id="submit_success_info">${message:submit-success}</p>
                        </t:if>
                    </t:form>
                   
                </div>
            </div>      
          </t:if>                            
        </t:block>
        
        <t:block id="infoBlock">
            ${infoMessage}
        </t:block>
        
        <t:block id="errorBlock">
            <div class="error">${infoMessage}</div>
        </t:block>
        
        <t:block id="emptyBlock">
            <span/>
        </t:block>
        
    </p:rightPanel>

</html>
