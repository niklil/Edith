<html t:type="layout"  
      xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
      xmlns:p="tapestry:parameter">
  
  <script type="text/javascript">
  (function($) {
    $(function() {
      
      $('#directory-tree').dynatree({
        initAjax: {
          url: '/documents:json'
        },
        
        onActivate: function(node) {
          if (node.data.isFolder) {
            $('#to_annotate').addClass('disabled');
            $('#path').val(node.data.path);
          } else {
            $('#to_annotate').removeClass('disabled');
          }
        },

        onLazyRead: function(node) {
          node.appendAjax({
            url: '/documents:json/',
            data: 'path=' + node.data.path
          });
        }
        
      });
      
      $('#to_annotate').click(function(e) {
        e.preventDefault();
        var node = $("#directory-tree").dynatree("getActiveNode");
        if (node != null) {
          window.location.href = '/document/annotate/' + node.data.documentId;
        }
      });

      
    });
  })(jQuery);
  </script>

  <p:title>${message:documents}</p:title>  

  <p:leftPanel>
    <div class="top_links">
      <span><a id="to_annotate" href="#" class="disabled">${message:to-annotate-document}</a></span>
    </div>
  </p:leftPanel>

  <h2>${message:documents}</h2>
      
  <div id="directory-tree"/>
      
	<t:form t:id="documentsForm">

	    <t:grid source="documents" row="document" exclude="id,title,svnPath,description" add="document,views,null,null1,null2,selection,deletion">
	        <p:documentCell>
	          ${document.title}
	        </p:documentCell>
	        <p:viewsCell>
	          <a t:type="pageLink" t:page="document/annotate" t:context="${document.id}">${message:annotate-document}</a>
	        </p:viewsCell>
	        <p:nullCell>
	            <a t:type="pageLink" t:page="document/view" t:context="${document.id}">${message:view-document}</a>
	        </p:nullCell>
	        <p:null1Cell>
	            <a t:type="pageLink" t:page="document/print" t:context="${document.id}">${message:print-document}</a>
	        </p:null1Cell>
	        <p:null2Cell>
                <a t:type="pageLink" t:page="document/publish" t:context="${document.id}">${message:publishVersion}</a>
            </p:null2Cell>
			<p:selectionCell>
				<t:checkbox value="documentSelected" />			
			</p:selectionCell>
			
			<p:deletionCell>
				<t:checkbox value="selectedForDeletion" />
			</p:deletionCell>
			
	        <p:empty>
	            <p>${message:no-documents}</p>
	        </p:empty>
	    </t:grid>
		
		<t:if test="documentsNotEmpty">		
			<t:submit value="${message:select-documents}" />
					
			<input type="button" class="delete_question" style="font-size:80%; margin-left:0.5em;" value="${message:remove-selected}"/>
			
            <span class="delete_dialog" style="font-size:80%;"> 
            	${message:remove-selected}?
            	<t:submit t:id="removeSelected" value="${message:yes}"/>  
            	/ 
            	<input type="button" class="delete_decline" value="${message:no}"/> 
            </span> 
												
		</t:if>
		
	</t:form>

    <p:rightPanel>
        <p>${message:add-document}</p>   
        <t:document.upload/>
    </p:rightPanel>

	<script type="text/javascript">
	
	</script>

</html>
