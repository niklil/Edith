<html t:type="layout" xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd"
	xmlns:p="tapestry:parameter">

	<p:title>${document.title}</p:title>

	<div class="content">
		<t:zone t:id="documentZone" update="show">
			<t:delegate to="documentView" />
		</t:zone>
		<t:block t:id="documentView">
			<t:document.view document="documentRevision" />
		</t:block>
	</div>

	<p:leftPanel>
	   <div id="document_links">
	   <div>
	      <span>${message:to-annotate-document}</span>
		  <span>
			 <a t:type="pageLink" t:page="document/view" t:context="${document.id}">${message:to-view-document}</a> 
		  </span>
		  <span>
			 <t:pagelink page="document/print" t:context="[document.id,documentRevision.revision]">${message:printVersion}</t:pagelink>
		  </span>
		  <span>
            <t:pagelink page="document/publish" t:context="document.id">${message:publishVersion}</t:pagelink>
          </span>
          </div>
          <div>
		  <span>
		      <a id="createTermLink" class="disabled selection-link" href="#">${message:createTerm}</a> 
		  </span>
		  
		  <t:if test="!slsMode">
		  <span>
              <t:eventlink t:event="createPerson" t:zone="dialogZone" class="jqmOpen">${message:createPerson}</t:eventlink>
          </span>
          <span>
              <t:eventlink t:event="createPlace" t:zone="dialogZone" class="jqmOpen">${message:createPlace}</t:eventlink>
          </span>
          </t:if>
          <span id="mode_switcher">
              <a id="normalNotes" href="#">${message:normalNotes}</a> | <a id="innerNotes" href="#">${message:innerNotes}</a> 
          </span>
          </div>
	   </div>
	</p:leftPanel>

	<p:rightPanel>
	
	<script type="text/javascript">
	  jQuery(function() {
		  
		 var saveState = function(event, ui) {
			 var id = jQuery(this).attr("id");
			 var state = jQuery(this).accordion("option", "active");
			 if (state === false) {
				 state = -1;
			 }
			 //alert("saving " + id +" "+ state)
             jQuery.cookie(id, state, {expires: 7});
		 };
		 
		 var loadState = function(event, ui) {
			 var id = jQuery(this).attr("id");
             var state = jQuery.cookie(id);
             //alert("loaded " + id + " " + state);
             if (state == 0) {
            	//alert("setting " + id + " " + state);
                jQuery(this).accordion("option", "active", 0);
             } 
		 }
		  
		 jQuery('#documentsAccordion').accordion({ collapsible: true, active: false, clearStyle:true, create: loadState, change: saveState});
		 jQuery('#searchAccordion').accordion({ collapsible: true, active: false, clearStyle:true, create: loadState, change: saveState });
		 jQuery('#searchResultsAccordion').accordion({ collapsible: true, active: false, clearStyle:true, create: loadState, change: saveState });
		 jQuery('#instancesAccordion').accordion({ collapsible: true, active: false, clearStyle:true, create: loadState, change: saveState });
		 jQuery('#editAccordion').accordion({ collapsible: true, active: false, clearStyle:true, create: loadState, change: saveState });
		 
		 jQuery("#documentsTree").dynatree();
		 
	   });
	</script>
	
	
	<div id="documentsAccordion">
        <h5><a href="#">${message:documents-label}</a></h5>
        <div id="documentsTree">
            <ul>
                <li>
                    <span>Kansio 1</span>
                    <ul>
                        <li>Dokumentti1</li>
                        <li>Dokumentti2</li>
                    </ul>
                </li>
                
                <li>
                    <span>Kansio 2</span>
                    <ul>
                        <li>Dokumentti1</li>
                        <li>Dokumentti2</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    <div id="searchAccordion">
        <h3><a href="#">${message:notesearch}</a></h3>
        <div>
            <t:note.noteSearchForm />
        </div>
    </div>
	<div id="searchResultsAccordion">
        <h3><a href="#">${message:notesearchresults}</a></h3>
        <div>
            <t:note.searchResults />        
        </div>
    </div>
    <div id="instancesAccordion">
        <h3><a href="#">${message:document-notes}</a></h3>
        <div>
        
            <t:note.documentNotes noteEdit="noteEdit"/>
        
            <t:remove>
            <!-- This is going to be replaced with *** model -->    
	        <t:if test="moreThanOneSelectable">
	           <h3>${message:selectNote}</h3>
	           <ul class="notes">
	
	               <t:loop source="selectedNotes" value="note">
	                   <li>
	                       <t:eventlink t:event="edit" context="e${note.localId}" t:zone="editZone" class="notelink">
	                           <em>${note.note.lemma}</em>
	                       </t:eventlink>
	                   </li>
	               </t:loop>
	           </ul>
	        </t:if>
            </t:remove>
        </div>
    </div>
	
	<div id="editAccordion">
        <h3><a href="#">${message:noteEdit}</a></h3>
        <div>
          
          <t:note.noteEdit />
              
        </div>
    </div>
	
    <t:form t:id="createTerm" t:zone="listZone">
       <t:hidden t:id="selectedText_1" value="createTermSelection.selection" />
       <t:hidden t:id="selectedStartId_1" value="createTermSelection.startId" />
       <t:hidden t:id="selectedEndId_1" value="createTermSelection.endId" />
       <t:hidden t:id="selectedStartIndex_1" value="createTermSelection.startIndex" />
       <t:hidden t:id="selectedEndIndex_1" value="createTermSelection.endIndex" />
    </t:form>
    
    <t:form t:id="selectNoteForm" t:zone="noteEditZone">
        <t:hidden t:id="selectedNoteLocalId" value="selectedNoteLocalId" />
    </t:form>
    
	<t:block id="emptyBlock">
		<span />
	</t:block>

	</p:rightPanel>
  
    <t:infoMessage />

    <div class="jqmWindow" id="dialog">
        <t:zone t:id="dialogZone" update="show">${message:creatingNote}...</t:zone>
    
        <a href="#" class="jqmClose">${message:close}</a>
    </div>
    
    <t:remove>
    <t:block t:id="notesForLemma">
        <div><strong>${message:createNewNoteOrChooseExistingOne}</strong></div>
    <t:loop source="notes" value="loopNote">
        <div>
        <t:eventlink t:event="chooseBackingNote" context="loopNote.id" t:zone="editZone"><em>${loopNote.lemma}</em></t:eventlink>
        ${loopNote.lemmaMeaning}
        ${loopNoteConcept.description}
        </div>
    </t:loop>
    <t:eventlink t:event="chooseBackingNote" t:zone="editZone">${message:createNewNote-label}</t:eventlink>
    </t:block>
    </t:remove>
    
    <t:block t:id="closeDialog">
        ${message:create-success}
    </t:block>
    
    <t:block t:id="personForm">
        <t:note.personForm closeDialog="closeDialog"/>
    </t:block>
    
    <t:block t:id="placeForm">
        <t:note.placeForm closeDialog="closeDialog"/>
    </t:block>

	<script type="text/javascript">
		var l10n = new Array();
		l10n.invalidSelection = "${message:invalid-selection-error}";
	</script>
	
		
</html>
