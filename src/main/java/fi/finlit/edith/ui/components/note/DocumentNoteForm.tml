<html xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">
<t:content>

    <script type="text/javascript">
      //XXX Maybe these should be on external file
      var DocumentNoteForm = {
    	  originalText : "${documentNoteOnEdit.longText}",
          setTextSelection : function() {
        	  jQuery("#longTextEdit").html(this.originalText + " --> " + TextSelector.selection);
        	  jQuery(":input[name='selectedStartId_2']").val(TextSelector.startId);
              jQuery(":input[name='selectedEndId_2']").val(TextSelector.endId);
              jQuery(":input[name='selectedText_2']").val(TextSelector.selection);
              jQuery(":input[name='selectedStartIndex_2']").val(TextSelector.startIndex);
              jQuery(":input[name='selectedEndIndex_2']").val(TextSelector.endIndex);
          },
          clearTextSelection : function() {
        	  jQuery("#longTextEdit").html(this.originalText);
              jQuery(":input[name='selectedText_2']").val(null);
          }
    		  
      };
    
      jQuery(function() {
    	  
    	  //Remove previously binded versions
    	  var eventName = "mousemove.documentNoteForm";
    	  
    	  jQuery('body').unbind(eventName);
    	  //Show update button, if there is selection
    	  jQuery('body').bind(eventName, function() {
    		  
    		  var saveButton = jQuery(".document-note-form :input[name^='save']"); 
    		  
              if(TextSelector.getSelection() == "") { 
                  saveButton.val("${message:save}");
                  DocumentNoteForm.clearTextSelection();
              } else {
            	  
            	  if (!TextSelector.updateIndices(TextSelector.getSelection())) {
            		  return;
            	  }
            	  
                  saveButton.val("${message:updateLink}");
                  DocumentNoteForm.setTextSelection();
                  
              }
          });
    	  
    	  
      });
    </script>
    
    <div class="document-note-form">
        
      <t:form t:id="documentNoteForm" t:context="documentNoteOnEdit.id" t:zone="noteEditZone">
        <fieldset>
        <legend>${message:document-note}</legend>
        
        <div class="metadata">
        <t:dateTimeFormat date="documentNoteOnEdit.createdOnDate" format="message:dateformat-compact" />
        </div>
        
        <t:errors />
        
        <div class="field">
            <label for="longTextEdit">${message:longText-label}</label>
            <div id="longTextEdit">${documentNoteOnEdit.longText}</div>
        </div>
        
        <div class="field">
            <t:label for="lemmaPosition">${message:lemmaPosition-label}</t:label>
            <t:textField t:id="lemmaPosition" value="documentNoteOnEdit.lemmaPosition" />
        </div>
        
        <t:hidden t:id="noteOnEditId" value="documentNoteOnEdit.id" />
        
        <t:hidden t:id="selectedText_2" value="updateLongTextSelection.selection" />
        <t:hidden t:id="selectedStartId_2" value="updateLongTextSelection.startId" />
        <t:hidden t:id="selectedEndId_2" value="updateLongTextSelection.endId" />
        <t:hidden t:id="selectedStartIndex_2" value="updateLongTextSelection.startIndex" />
        <t:hidden t:id="selectedEndIndex_2" value="updateLongTextSelection.endIndex" />
    
        <t:submit t:id="save" value="${message:save}" />
        <t:submit class="right" t:id="delete" value="${message:delete}" />
        </fieldset>
      </t:form>
    </div>
</t:content>
</html>