<html xmlns:t="http://tapestry.apache.org/schema/tapestry_5_1_0.xsd">
	<t:content>
		<t:form t:id="noteEditForm" t:zone="editZone" t:context="noteOnEdit.id">
			<t:errors />
			<div>
				<div>
					<strong>${message:format-label}</strong>
				</div>
				<div>
					<t:select t:id="format" />
				</div>
			</div>

			<div>
				<div>
					<strong>${message:status-label}</strong>
				</div>
				<div>
					<t:select model="statusModel" value="status" />
				</div>
			</div>

			<div class="note">
				<div>
					<strong>${message:lemma-label}</strong>
				</div>
				<div>
					<t:textField value="noteOnEdit.note.lemma" />
				</div>
			</div>

			<div class="note">
				<div>- ${message:meaning-label}</div>
				<div>
					<t:textField value="noteOnEdit.note.lemmaMeaning" />
				</div>
			</div>

			<div class="note">
				<div>
					<strong>${message:type-label}</strong>
				</div>
				<div>
					<t:loop source="types" value="type">
						<div>
							<t:checkbox value="selected" />
							<t:fmt.message key="${type}" />
						</div>
					</t:loop>
				</div>
			</div>
            
			<div class="note">
				<div>
					<strong>${message:basicForm-label}</strong> (${termInstances} ${message:amountOfInstances})
				</div>
				<div>
					<t:textField t:id="basicForm" value="termOnEdit.basicForm"
						t:mixins="termAutocomplete" />
				</div>
			</div>

			<div class="note">
				<div>- ${message:meaning-label}</div>
				<div>
					<t:textArea rows="8" t:id="termMeaning" value="termOnEdit.meaning" />
				</div>
			</div>

			<div class="note">
				<div>- ${message:language-label}</div>
				<div>
					<t:select t:id="language" />
				</div>
			</div>
			
			<div class="person">
			         <strong>${message:personSearch}</strong>
            <t:textField t:id="person" value="search" t:mixins="personAutocomplete" />
			         <t:textfield t:id="personId" value="personId" style="display: none;"/>
                
            </div>
			<t:zone id="personZone" t:id="personZone" t:zone="personZone" update="show">
			    <t:block t:id="personForm">
        <t:block t:id="editPersonForm">
            <t:note.personForm closeDialog="closeDialog" personId="personId"/>
        </t:block>
    </t:block>
			<script type="text/javascript">
			jQuery(function() {
			    jQuery("input[name='personId']").attr("value", jQuery("#personId").attr("name"));
			});
			jQuery(function() {
			    jQuery(".editPerson").click(function() {
				    jQuery("#dialog").jqmShow();
			    });
			});
			</script>
			
			<div id="personId" name="${personId}" style="display: none;"/>
            <t:if test="person">
            <div class="person">
                <div><strong>${message:normalizedForm-label}</strong> (${personInstances} ${message:amountOfInstances})</div>
                <t:if test="normalizedFirst">
                    <div>- ${message:firstName-label}</div>
                    <div>${normalizedFirst}</div>
                </t:if>
                <t:if test="normalizedLast">
                    <div>- ${message:lastName-label}</div>
                    <div>${normalizedLast}</div>
                </t:if>
                <t:if test="normalizedDescription">
                    <div>- ${message:description-label}</div>
                    <div>${normalizedDescription}</div>
                </t:if>
            </div>

            <div class="person">
            <t:loop source="persons" value="loopPerson" volatile="true">
                <div>
                    <div><strong>${message:nameForm-label}</strong></div>
                    <t:if test="loopPerson.first">
                        <div>- ${message:firstName-label}</div>
                        <div>${loopPerson.first}</div>
                    </t:if> 
                    <t:if test="loopPerson.last">
                        <div>- ${message:lastName-label}</div>
                        <div>${loopPerson.last}</div>
                    </t:if>
                    <t:if test="loopPerson.description">
                        <div>- ${message:description-label}</div>
                        <div>${loopPerson.description}</div>
                    </t:if>
                </div>
            </t:loop>
            </div>

            <t:if test="timeOfBirth">
            <div class="person">
                <div>
                    <strong>${message:timeOfBirth-label} (d.M.y)</strong>
                </div>
                <div>
                    ${timeOfBirth}
                </div>
            </div>
            </t:if>

            <t:if test="timeOfDeath">
            <div class="person">
                <div>
                    <strong>${message:timeOfDeath-label} (d.M.y)</strong>
                </div>
                <div>
                    ${timeOfDeath}
                </div>
            </div>
            </t:if>
            
            <t:eventlink t:event="editPerson" t:zone="dialogZone" class="jqModal person editPerson" t:context="personId">${message:editPerson}</t:eventlink>
            </t:if>
            </t:zone>
			<div class="note person place">
				<div>
					<strong>${message:description-label}</strong>
				</div>
				<div>
					<t:textArea value="description" rows="8" />
				</div>
			</div>

			<div class="note person place">
				<div>
					<strong>${message:sources-label}</strong>
				</div>
				<div>
					<t:textField value="sources" rows="8" />
				</div>
			</div>

			<div class="note person place">
				<div>
					<strong>${message:subtextSources-label}</strong>
				</div>
				<div>
					<t:textField t:id="subtextSources" value="noteOnEdit.note.subtextSources" />
				</div>
			</div>

			<div>
				<div></div>
				<div>
					<a id="longTextEditLink" href="#">${message:update}</a>
				</div>
			</div>

			<div>
				<div>
					<strong>${message:longText-label}</strong>
				</div>
				<div>
					<div id="longTextEdit">${noteOnEdit.longText}</div>
				</div>
			</div>

			<t:hidden t:id="selectedText_2" value="updateLongTextSelection.selection" />
			<t:hidden t:id="selectedStartId_2" value="updateLongTextSelection.startId" />
			<t:hidden t:id="selectedEndId_2" value="updateLongTextSelection.endId" />
			<t:hidden t:id="selectedStartIndex_2" value="updateLongTextSelection.startIndex" />
			<t:hidden t:id="selectedEndIndex_2" value="updateLongTextSelection.endIndex" />

			<input type="submit" value="${message:save}" />
            <t:checkbox value="saveAsNew" />${message:saveAsNew}
			<t:if test="submitSuccess">
				<!-- This could be externalized? -->
				<script type="text/javascript">
					jQuery(function() {
					jQuery("#submit_success_info").fadeOut(3000);
					});</script>
				<p id="submit_success_info">${message:submit-success}</p>
			</t:if>
		</t:form>
	</t:content>
</html>